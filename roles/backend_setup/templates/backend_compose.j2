# docker-compose.yml: Backend + Mongo services
# Generated via Jinja2 template inside backend_setup role
# Purpose: Spins up backend Node.js service alongside MongoDB for development/testing

version: '3.8'  # Specifies Compose file format version compatible with modern Docker engines

services:
  mongo:
    image: mongo:latest        # Pulls the latest official MongoDB image from Docker Hub
    ports:
      - "27018:27017"          # Maps container port 27017 to host port 27018 to avoid collision with local Mongo
    volumes:
      - ./mongo_data:/data/db  # Mounts local volume to persist MongoDB data between container restarts
    restart: always            # Ensures Mongo container restarts automatically if it crashes or host reboots

  yolo-backend:
    build: ./backend           # Builds image from Dockerfile located in ./backend directory
    ports:
      - "5000:5000"            # Maps container port 5000 to host port 5000 for API access
    env_file:
      - ./backend/.env         # Loads environment variables (like MONGODB_URI) from .env file in backend dir
    depends_on:
      - mongo                  # Ensures Mongo container starts before backend to avoid connection errors
    restart: always            # Automatically restarts backend container on failure or system reboot
